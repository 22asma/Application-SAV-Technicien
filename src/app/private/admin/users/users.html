<div class="users-container" *appHasPermission="['user.view', 'user.manage']">
  <!-- Message de chargement -->
  <div *ngIf="loading" class="loading-message">
    <i class="icon icon-spinner"></i> {{ 'users.loading' | translate }}
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage && !loading" class="error-message">
    {{ errorMessage }}
    <button class="btn btn-outline" (click)="loadUsers()">
      <i class="icon icon-refresh"></i> {{ 'users.retry' | translate }}
    </button>
  </div>

  <!-- Datatable avec données -->
  <div *ngIf="!loading && !errorMessage && users.length > 0" class="table-wrapper">
    <app-datatable
      [data]="users"
      [columns]="userColumns"
      [actions]="userActions"
      [entriesPerPage]="itemsPerPage"
      [totalEntries]="totalEntries"
      [currentPage]="currentPage"
      [lastPage]="lastPage"
      (pageChange)="onPageChange($event)"
      [showSearch]="true"
      [showExport]="true"
      [showPagination]="true"
      [showAddButton]="true"
      [serverSideSearch]="true"
      [showDateFilterButton]="false"
      [dateRangeFilterEnabled]="true"
      [entriesPerPageOptions]="[10, 25, 50, 100]"
      (addClicked)="onAddClicked()"
      (exportData)="onExportData($event)"
      (rowSelect)="onRowSelect($event)"
      (filterChange)="onFilterChange($event)"
      [searchValue]="searchValue"
      [showFilters]="true"
      (searchCleared)="onSearchCleared()"
      (barcodeClicked)="handleBarcodeClick($event)">
    </app-datatable>
  </div>

  <!-- Message quand aucun résultat trouvé pour une recherche -->
  <div *ngIf="!loading && !errorMessage && users.length === 0 && noDataFound" class="no-search-results">
    <div class="no-results-icon">
      <i class="icon icon-search"></i>
    </div>
    <h3>{{ 'users.no_results.title' | translate }}</h3>
    <p>{{ 'users.no_results.message' | translate:{search: filters.keyword} }}</p>
    <div class="no-results-actions">
      <button class="btn btn-outline" (click)="clearSearch()">
        <i class="icon icon-x"></i> {{ 'users.no_results.clear_search' | translate }}
      </button>
      <button class="btn btn-primary" (click)="onAddClicked()">
        <i class="icon icon-plus"></i> {{ 'users.no_results.add_user' | translate }}
      </button>
    </div>
  </div>

  <!-- Message si aucune donnée en général (première fois) -->
  <div *ngIf="!loading && !errorMessage && users.length === 0 && !noDataFound && (!filters.keyword || filters.keyword.trim() === '')" class="no-data-message">
    <div class="no-data-icon">
      <i class="icon icon-users"></i>
    </div>
    <h3>{{ 'users.no_data.title' | translate }}</h3>
    <p>{{ 'users.no_data.message' | translate }}</p>
    <button class="btn btn-primary" (click)="onAddClicked()">
      <i class="icon icon-plus"></i> {{ 'users.no_data.add_first' | translate }}
    </button>
  </div>
</div>