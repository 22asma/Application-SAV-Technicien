
<!-- Template HTML converti -->
<div class="tech-modal-container" *appHasPermission="['task.history']">   
  <div class="tech-modal-header">     
    <h2>Journal du technicien</h2>     
    <button (click)="onClose()" class="close-button">       
      <i class="material-icons">close</i>     
    </button>   
  </div>    

  <div class="modal-content">     
    <div class="technicien-info-card">       
      <div class="technicien-identity">         
        <i class="material-icons avatar-icon">person</i>         
        <div class="identity-details">           
          <span class="technicien-name">{{technicien.lastName}} {{technicien.firstName}}</span>           
          <span class="technicien-username">{{technicien.username}}</span>         
        </div>       
      </div>       
      <div class="technicien-status">         
        <span class="status-badge" [ngClass]="getStatusClass()">           
          {{ getStatusLabel() }}         
        </span>       
      </div>     
    </div>      

   <div class="history-controls">
  <h3>{{ getHistoryTitle() }}</h3>
  <button (click)="toggleFilter()" class="filter-button">
    <i class="material-icons">filter_alt</i>
    Filtrer
  </button>
</div>
    <div class="filter-section" *ngIf="showFilter">       
      <form [formGroup]="filterForm">         
        <div class="filter-fields">           
          <div class="form-field date-field">             
            <label>Date de début</label>             
            <input type="date" formControlName="startDate" class="date-input">           
          </div>            

          <div class="form-field date-field">             
            <label>Date de fin</label>             
            <input type="date" formControlName="endDate" class="date-input">           
          </div>         
        </div>          

        <div class="filter-actions">           
          <button type="button" (click)="resetFilter()" class="reset-button">Réinitialiser</button>           
          <button type="button" (click)="applyFilter()" class="apply-button">Appliquer</button>         
        </div>       
      </form>     
    </div>      

    <div class="history-section">       
      <div *ngIf="loading" class="loading-state">         
        <div class="spinner"></div>         
        <span>Chargement en cours...</span>       
      </div>        

      <div *ngIf="errorMessage" class="error-state">         
        <i class="material-icons">error_outline</i>         
        <span>{{ errorMessage }}</span>       
      </div>        

      <div *ngIf="!loading && !errorMessage" class="history-table-container">         
        <table class="history-table">           
          <thead>             
            <tr>        
              <th class="date-header">Date</th>       
              <th class="time-header">Heure</th>               
              <th class="type-header">Type</th>               
              <th class="task-header">Tâche</th>             
            </tr>           
          </thead>           
          <tbody>             
            <tr *ngFor="let entry of journalData">
              <td class="date-cell">{{entry.dateFormatted}}</td>               
              <td class="time-cell">{{entry.heure}}</td>               
              <td class="type-cell">                 
                <span class="type-badge" [ngClass]="getBadgeClass(entry.rawType)">                   
                  {{entry.type}}                 
                </span>               
              </td>               
              <td class="task-cell">{{entry.tache}}</td>             
            </tr>             
            <tr *ngIf="journalData.length === 0">
              <td colspan="4" class="no-data"></td>               
              <td colspan="3" class="no-data">                 
                <i class="material-icons">info</i>                 
                <span>Aucun enregistrement pour cette période</span>               
              </td>             
            </tr>           
          </tbody>         
        </table>       
      </div>     
    </div>   
  </div> 
</div>