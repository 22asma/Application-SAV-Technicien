<div class="ordreReparation-container" *appHasPermission="['or.view']">
  <!-- Message de chargement -->
  <div *ngIf="loading" class="loading-message">
    <i class="icon icon-spinner"></i> Chargement en cours...
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage && !loading" class="error-message">
    {{ errorMessage }}
    <button class="btn btn-outline" (click)="loadORs()">
      <i class="icon icon-refresh"></i> Réessayer
    </button>
  </div>

  <!-- Datatable avec données -->
  <div *ngIf="!loading && !errorMessage && ordreReparation.length > 0" class="table-wrapper">
    <app-datatable
      [data]="ordreReparation"
      [columns]="columns"
      [actions]="actions"
      [entriesPerPage]="itemsPerPage"
      [totalEntries]="totalEntries"
      [currentPage]="currentPage"
      [lastPage]="lastPage"
      [showSearch]="true"
      [showFilters]="true"
      [showExport]="true"
      [showPagination]="true"
      [serverSideSearch]="true"
      [entriesPerPageOptions]="[10, 25, 50, 100]"
      [statusFilterOptions]="statusFilterOptions"
      [dateRangeFilterEnabled]="true"
      [showDateFilterButton]="true"
      (exportData)="onExportData($event)"
      (rowSelect)="onRowSelect($event)"
      (filterChange)="onFilterChange($event)"
      (pageChange)="onPageChange($event)"
      (statusFilter)="onStatusFilterChange($event)"
      (dateRangeFilter)="onDateRangeFilter($event)"
      [showFilters]="true"
      (searchCleared)="onSearchCleared()"
      [searchValue]="searchValue">
    </app-datatable>
  </div>

  <!-- Message quand aucun résultat trouvé pour une recherche -->
  <div *ngIf="!loading && !errorMessage && ordreReparation.length === 0 && noDataFound" class="no-search-results">
    <div class="no-results-icon">
      <i class="icon icon-search"></i>
    </div>
    <h3>Aucun résultat trouvé</h3>
    <p>Aucun ordre de réparation ne correspond à vos critères de recherche</p>
    <div class="no-results-actions">
      <button class="btn btn-outline" (click)="clearSearch()">
        <i class="icon icon-x"></i> Effacer la recherche
      </button>
      <button class="btn btn-primary" (click)="clearAllFilters()">
        <i class="icon icon-refresh"></i> Réinitialiser tous les filtres
      </button>
    </div>
  </div>

  <!-- Message si aucune donnée en général (première fois) -->
  <div *ngIf="!loading && !errorMessage && ordreReparation.length === 0 && !noDataFound && (!filters.keyword || filters.keyword.trim() === '')" class="no-data-message">
    <div class="no-data-icon">
      <i class="icon icon-file-text"></i>
    </div>
    <h3>Aucun ordre de réparation</h3>
    <p>Il n'y a encore aucun ordre de réparation dans le système.</p>
  </div>
</div>